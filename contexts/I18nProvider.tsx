
import React from 'react';
import { createContext, useState, useCallback } from 'react';

type Language = 'en' | 'vi';

interface I18nContextType {
    language: Language;
    setLanguage: (lang: Language) => void;
    t: (key: string, params?: Record<string, string | number>) => string;
}

const translations = {
    en: {
        dashboard: 'Dashboard',
        leads: 'Leads',
        myLeads: 'My Leads',
        myLeadsDesc: 'Manage all leads assigned to you.',
        students: 'Students',
        profile: 'Profile',
        jdParser: 'JD Parser',
        settings: 'Settings',
        teams: 'Teams',
        jobs: 'Job Postings',
        opsDashboard: 'Ops Dashboard',
        totalRevenue: 'Total Revenue',
        newLeads: 'New Leads',
        conversionRate: 'Conversion Rate',
        activeLearners: 'Active Learners',
        salesOverview: 'Sales Overview',
        leadsBySource: 'Leads by Source',
        anomalyAlerts: 'Anomaly Alerts',
        viewAll: 'View All',
        ack: 'ACK',
        allLeads: 'All Leads',
        allStudents: 'All Students',
        exportCsv: 'Export CSV',
        name: 'Name',
        status: 'Status',
        score: 'Score',
        tier: 'Tier',
        source: 'Source',
        assignee: 'Assignee',
        created: 'Created',
        actions: 'Actions',
        welcome: 'Welcome to Synergy CRM',
        jdParserTitle: 'Job Description Parser',
        jdParserDesc: 'Paste a job description below to parse skills and requirements.',
        studentProfileTitle: 'Student Skill Profile',
        studentProfileDesc: 'Dynamic skill map for student evaluation and matching.',
        search: 'Search...',
        theme: 'Theme',
        light: 'Light',
        dark: 'Dark',
        system: 'System',
        language: 'Language',
        course: 'Course',
        progress: 'Progress',
        joinDate: 'Join Date',
        addStudent: 'Add Student',
        editStudent: 'Edit Student',
        viewProfile: 'View Profile',
        edit: 'Edit',
        delete: 'Delete',
        taskProgress: 'Task Progress',
        dueDate: 'Due',
        areYouSure: 'Are you sure?',
        deleteStudentWarning: 'This action cannot be undone. This will permanently delete the student and their associated data.',
        deleteUserWarning: 'This action cannot be undone. This will permanently delete the user {userName} and all associated data.',
        cancel: 'Cancel',
        save: 'Save',
        parseAndMatch: 'Parse & Match Candidates',
        parsing: 'Parsing...',
        jdParsingResults: 'JD Parsing Results',
        requiredSkills: 'Required Skills',
        softSkills: 'Soft Skills',
        experience: 'Experience',
        years: 'years',
        hiddenRequirements: 'Hidden Requirements',
        pasteJDPlaceholder: 'Paste your job description here...',
        jdParseError: 'An error occurred while parsing. Please try again.',
        matchingCandidates: "Matching Candidates",
        findingMatches: "Finding matches...",
        matchScore: "Match Score",
        matchingSkills: "Matching Skills",
        noCandidatesFound: "No suitable candidates found for this job description.",
        requestInterview: "Request Interview",
        skills: 'Skills',
        skillsPlaceholder: 'e.g. React, Node.js, SQL',
        skillsHelperText: 'Comma-separated values',
        login: 'Login',
        logout: 'Logout',
        email: 'Email',
        password: 'Password',
        loginToYourAccount: 'Login to your account',
        allTeams: 'All Teams',
        manageTeams: 'Manage student teams and projects.',
        allJobs: 'All Jobs',
        manageJobs: 'Manage company job postings and candidates.',
        opsDashboardTitle: 'Operations Dashboard',
        opsDashboardDesc: 'System-wide analytics and management.',
        createTeam: 'Create Team',
        addNewTeam: 'Add a new team',
        teamName: 'Team Name',
        projectDescription: 'Project Description',
        projectDescriptionPlaceholder: 'Describe the project goals and tech stack...',
        suggestMembers: 'Suggest Members',
        suggesting: 'Suggesting...',
        suggestedMembers: 'Suggested Members',
        postNewJob: 'Post New Job',
        addNewJob: 'Add a new job posting',
        jobTitle: 'Job Title',
        jobDescription: 'Job Description',
        viewMatches: 'View Matches',
        enrollmentTrends: 'Enrollment Trends',
        teamProjectStatus: 'Team Project Status',
        newStudents: 'New Students',
        skillMap: 'Skill Map',
        dynamicSkillMapDesc: 'Student\'s skills, updated in real-time based on performance.',
        interviewScheduledSuccess: 'Interview successfully scheduled with {candidateName}!',
        requestingInterview: 'Requesting...',
        editTeam: 'Edit Team',
        deleteTeam: 'Delete Team',
        deleteTeamWarning: 'This action cannot be undone. This will permanently delete the team and unassign its members.',
        myTeam: 'My Team',
        myProject: 'My Project',
        mentor: 'Mentor',
        teammates: 'Teammates',
        noTeamAssigned: 'You are not currently assigned to a team.',
        matchedJobs: 'Matched Jobs',
        matchedJobsDesc: 'Job opportunities that match your skill profile.',
        noMatchedJobs: 'No matched jobs found at the moment. Keep improving your skills!',
        viewJob: 'View',
        studentSettings: 'My Settings',
        personalInformation: 'Personal Information',
        fullName: 'Full Name',
        age: 'Age',
        changePassword: 'Change Password',
        currentPassword: 'Current Password',
        newPassword: 'New Password',
        confirmNewPassword: 'Confirm New Password',
        updatePassword: 'Update Password',
        myTeams: 'My Teams',
        teamDetails: 'Team Details',
        projectDetails: 'Project Details',
        members: 'Members',
        manageMembers: 'Manage Members',
        assignTask: 'Assign Task',
        teamTasks: 'Team Tasks',
        assignTo: 'Assign To',
        allMembers: 'All Members',
        taskTitle: 'Task Title',
        editTask: 'Edit Task',
        taskDetails: 'Task Details',
        assignedTo: 'Assigned To',
        updateTask: 'Update Task',
        claimLeads: 'Claim Leads',
        unassignedLeads: 'Unassigned Leads',
        unassignedLeadsDesc: 'Pick leads from this pool to start working on them.',
        claim: 'Claim',
        claiming: 'Claiming...',
        leadClaimedSuccess: 'Lead "{leadName}" has been successfully assigned to you!',
        noUnassignedLeads: 'There are no unassigned leads at the moment. Great work!',
        classification: 'Classification',
        leadClassification: 'Lead Classification',
        classificationStudent: 'Student',
        classificationIntern: 'Intern',
        classificationEnterprise: 'Enterprise',
        classificationLecturer: 'Lecturer',
        classificationUniversity: 'University',
        classificationPartner: 'Partner',
        evaluate: 'Evaluate',
        evaluateMember: 'Evaluate {studentName}',
        evaluateMemberDesc: "Rate the student's skills and add new ones as needed.",
        addSkill: 'Add Skill',
        newSkillName: 'New Skill Name',
        skillEvaluationSuccess: "Successfully updated {studentName}'s skill profile.",
        skillEvaluationError: "Failed to update skill profile.",
        allJobsTitle: "All Jobs",
        allJobsDesc: "Browse all available job opportunities.",
        company: "Company",
        postedDate: "Posted Date",
        viewDetails: "View Details",
        jobDetails: "Job Details",
        complete: "Complete",
        taskCompletedSuccess: "Task marked as completed!",
        taskInProgressSuccess: "Task status set to in progress.",
        taskUpdateError: "Failed to update task status.",
        backToMatches: "Back to Matches",
        notifications: "Notifications",
        markAllAsRead: "Mark all as read",
        noNotifications: "No new notifications",
        interviewRequestTitle: "Interview Request",
        interviewRequestMessage: "{companyName} has invited you to an interview for the {jobTitle} role.",
        requestInterviewDetails: "Request Interview Details",
        interviewTime: "Interview Time",
        interviewLocation: "Location",
        locationPlaceholder: "e.g. Company HQ, Online via Meet",
        confirmRequest: "Confirm Request",
        interviewDetails: "Interview Details",
        youAreInvited: "You are invited for an interview!",
        accept: "Accept",
        decline: "Decline",
        interviewAccepted: "Interview Accepted",
        interviewDeclined: "Interview Declined",
        pendingResponse: "Pending Your Response",
        interviewResponseSuccess: "Your response has been recorded.",
        interviewResponseError: "Failed to record your response.",
        unassigned: 'Unassigned',
        interviewAcceptedTitle: 'Interview Accepted',
        interviewDeclinedTitle: 'Interview Declined',
        interviewAcceptedMessage: '{studentName} has accepted your interview for the {jobTitle} role.',
        interviewDeclinedMessage: '{studentName} has declined your interview for the {jobTitle} role.',
        address: 'Address',
        phone: 'Phone Number',
        nationalId: 'National ID',
        companies: 'Companies',
        agents: 'Agents',
        manageCompanies: 'Manage all partner companies.',
        addCompany: 'Add Company',
        editCompany: 'Edit Company',
        deleteCompanyWarning: 'This action will permanently delete the company {companyName}.',
        industry: 'Industry',
        contactEmail: 'Contact Email',
        manageAgents: 'Manage all agent accounts.',
        addAgent: 'Add Agent',
        editAgent: 'Edit Agent',
        studentDirectory: 'Student Directory',
        studentDirectoryDesc: 'Browse student profiles for potential candidates.',
    },
    vi: {
        dashboard: 'Bảng điều khiển',
        leads: 'Khách hàng tiềm năng',
        myLeads: 'Lead của tôi',
        myLeadsDesc: 'Quản lý tất cả các lead được giao cho bạn.',
        students: 'Học viên',
        profile: 'Hồ sơ',
        jdParser: 'Phân tích JD',
        settings: 'Cài đặt',
        teams: 'Đội nhóm',
        jobs: 'Tin tuyển dụng',
        opsDashboard: 'Bảng điều khiển Vận hành',
        totalRevenue: 'Tổng doanh thu',
        newLeads: 'Lead mới',
        conversionRate: 'Tỷ lệ chuyển đổi',
        activeLearners: 'Học viên tích cực',
        salesOverview: 'Tổng quan bán hàng',
        leadsBySource: 'Lead theo nguồn',
        anomalyAlerts: 'Cảnh báo bất thường',
        viewAll: 'Xem tất cả',
        ack: 'Xác nhận',
        allLeads: 'Tất cả Lead',
        allStudents: 'Tất cả học viên',
        exportCsv: 'Xuất CSV',
        name: 'Tên',
        status: 'Trạng thái',
        score: 'Điểm',
        tier: 'Mức độ',
        source: 'Nguồn',
        assignee: 'Người phụ trách',
        created: 'Ngày tạo',
        actions: 'Hành động',
        welcome: 'Chào mừng đến với Synergy CRM',
        jdParserTitle: 'Trình phân tích Mô tả Công việc',
        jdParserDesc: 'Dán mô tả công việc vào bên dưới để phân tích kỹ năng và yêu cầu.',
        studentProfileTitle: 'Hồ sơ Năng lực Học viên',
        studentProfileDesc: 'Sơ đồ kỹ năng động để đánh giá và ghép cặp học viên.',
        search: 'Tìm kiếm...',
        theme: 'Giao diện',
        light: 'Sáng',
        dark: 'Tối',
        system: 'Hệ thống',
        language: 'Ngôn ngữ',
        course: 'Khóa học',
        progress: 'Tiến độ',
        joinDate: 'Ngày tham gia',
        addStudent: 'Thêm học viên',
        editStudent: 'Chỉnh sửa học viên',
        viewProfile: 'Xem hồ sơ',
        edit: 'Chỉnh sửa',
        delete: 'Xóa',
        taskProgress: 'Tiến độ nhiệm vụ',
        dueDate: 'Hạn chót',
        areYouSure: 'Bạn có chắc không?',
        deleteStudentWarning: 'Hành động này không thể hoàn tác. Thao tác này sẽ xóa vĩnh viễn học viên và dữ liệu liên quan của họ.',
        deleteUserWarning: 'Hành động này không thể hoàn tác. Thao tác này sẽ xóa vĩnh viễn người dùng {userName} và tất cả dữ liệu liên quan của họ.',
        cancel: 'Hủy',
        save: 'Lưu',
        parseAndMatch: 'Phân tích & Ghép cặp',
        parsing: 'Đang phân tích...',
        jdParsingResults: 'Kết quả phân tích JD',
        requiredSkills: 'Kỹ năng yêu cầu',
        softSkills: 'Kỹ năng mềm',
        experience: 'Kinh nghiệm',
        years: 'năm',
        hiddenRequirements: 'Yêu cầu ẩn',
        pasteJDPlaceholder: 'Dán mô tả công việc của bạn vào đây...',
        jdParseError: 'Đã xảy ra lỗi khi phân tích. Vui lòng thử lại.',
        matchingCandidates: "Ứng viên phù hợp",
        findingMatches: "Đang tìm ứng viên...",
        matchScore: "Điểm phù hợp",
        matchingSkills: "Kỹ năng trùng khớp",
        noCandidatesFound: "Không tìm thấy ứng viên phù hợp cho mô tả công việc này.",
        requestInterview: "Yêu cầu phỏng vấn",
        skills: 'Kỹ năng',
        skillsPlaceholder: 'VD: React, Node.js, SQL',
        skillsHelperText: 'Các giá trị cách nhau bằng dấu phẩy',
        login: 'Đăng nhập',
        logout: 'Đăng xuất',
        email: 'Email',
        password: 'Mật khẩu',
        loginToYourAccount: 'Đăng nhập vào tài khoản của bạn',
        allTeams: 'Tất cả Đội nhóm',
        manageTeams: 'Quản lý các đội nhóm và dự án của học viên.',
        allJobs: 'Tất cả việc làm',
        manageJobs: 'Quản lý tin tuyển dụng và ứng viên.',
        opsDashboardTitle: 'Bảng điều khiển Vận hành',
        opsDashboardDesc: 'Phân tích và quản lý toàn hệ thống.',
        createTeam: 'Tạo Đội',
        addNewTeam: 'Thêm một đội mới',
        teamName: 'Tên Đội',
        projectDescription: 'Mô tả dự án',
        projectDescriptionPlaceholder: 'Mô tả mục tiêu và công nghệ của dự án...',
        suggestMembers: 'Gợi ý thành viên',
        suggesting: 'Đang gợi ý...',
        suggestedMembers: 'Thành viên được gợi ý',
        postNewJob: 'Đăng tin mới',
        addNewJob: 'Thêm một tin tuyển dụng mới',
        jobTitle: 'Chức danh',
        jobDescription: 'Mô tả công việc',
        viewMatches: 'Xem ứng viên',
        enrollmentTrends: 'Xu hướng Tuyển sinh',
        teamProjectStatus: 'Trạng thái Dự án các Đội',
        newStudents: 'Học viên mới',
        skillMap: 'Bản đồ Kỹ năng',
        dynamicSkillMapDesc: 'Kỹ năng của học viên, được cập nhật thời gian thực dựa trên hiệu suất.',
        interviewScheduledSuccess: 'Đã lên lịch phỏng vấn thành công với {candidateName}!',
        requestingInterview: 'Đang yêu cầu...',
        editTeam: 'Chỉnh sửa Đội',
        deleteTeam: 'Xóa Đội',
        deleteTeamWarning: 'Hành động này không thể hoàn tác. Thao tác này sẽ xóa vĩnh viễn đội và hủy phân công các thành viên.',
        myTeam: 'Đội của tôi',
        myProject: 'Dự án của tôi',
        mentor: 'Người hướng dẫn',
        teammates: 'Đồng đội',
        noTeamAssigned: 'Bạn hiện chưa được phân vào đội nào.',
        matchedJobs: 'Việc làm phù hợp',
        matchedJobsDesc: 'Các cơ hội việc làm phù hợp với hồ sơ kỹ năng của bạn.',
        noMatchedJobs: 'Hiện không có việc làm phù hợp. Hãy tiếp tục trau dồi kỹ năng!',
        viewJob: 'Xem',
        studentSettings: 'Cài đặt của tôi',
        personalInformation: 'Thông tin cá nhân',
        fullName: 'Họ và tên',
        age: 'Tuổi',
        changePassword: 'Đổi mật khẩu',
        currentPassword: 'Mật khẩu hiện tại',
        newPassword: 'Mật khẩu mới',
        confirmNewPassword: 'Xác nhận mật khẩu mới',
        updatePassword: 'Cập nhật mật khẩu',
        myTeams: 'Đội của tôi',
        teamDetails: 'Chi tiết đội',
        projectDetails: 'Chi tiết dự án',
        members: 'Thành viên',
        manageMembers: 'Quản lý thành viên',
        assignTask: 'Giao nhiệm vụ',
        teamTasks: 'Nhiệm vụ của đội',
        assignTo: 'Giao cho',
        allMembers: 'Tất cả thành viên',
        taskTitle: 'Tiêu đề nhiệm vụ',
        editTask: 'Chỉnh sửa Nhiệm vụ',
        taskDetails: 'Chi tiết Nhiệm vụ',
        assignedTo: 'Giao cho',
        updateTask: 'Cập nhật Nhiệm vụ',
        claimLeads: 'Nhận Lead',
        unassignedLeads: 'Lead chưa được giao',
        unassignedLeadsDesc: 'Chọn lead từ danh sách này để bắt đầu tư vấn.',
        claim: 'Nhận',
        claiming: 'Đang nhận...',
        leadClaimedSuccess: 'Lead "{leadName}" đã được giao cho bạn thành công!',
        noUnassignedLeads: 'Hiện tại không có lead nào chưa được giao. Làm tốt lắm!',
        classification: 'Phân loại',
        leadClassification: 'Phân loại Lead',
        classificationStudent: 'Học viên',
        classificationIntern: 'Thực tập sinh',
        classificationEnterprise: 'Doanh nghiệp',
        classificationLecturer: 'Giảng viên',
        classificationUniversity: 'Trường đại học',
        classificationPartner: 'Đối tác',
        evaluate: 'Đánh giá',
        evaluateMember: 'Đánh giá {studentName}',
        evaluateMemberDesc: "Xếp hạng các kỹ năng của học viên và thêm kỹ năng mới nếu cần.",
        addSkill: 'Thêm Kỹ năng',
        newSkillName: 'Tên kỹ năng mới',
        skillEvaluationSuccess: "Đã cập nhật thành công hồ sơ kỹ năng của {studentName}.",
        skillEvaluationError: "Không thể cập nhật hồ sơ kỹ năng.",
        allJobsTitle: "Tất cả việc làm",
        allJobsDesc: "Duyệt tất cả các cơ hội việc làm có sẵn.",
        company: "Công ty",
        postedDate: "Ngày đăng",
        viewDetails: "Xem chi tiết",
        jobDetails: "Chi tiết công việc",
        complete: "Hoàn thành",
        taskCompletedSuccess: "Đã đánh dấu nhiệm vụ hoàn thành!",
        taskInProgressSuccess: "Đã đặt trạng thái nhiệm vụ là đang thực hiện.",
        taskUpdateError: "Cập nhật trạng thái nhiệm vụ thất bại.",
        backToMatches: "Quay lại danh sách ứng viên",
        notifications: "Thông báo",
        markAllAsRead: "Đánh dấu tất cả đã đọc",
        noNotifications: "Không có thông báo mới",
        interviewRequestTitle: "Yêu cầu phỏng vấn",
        interviewRequestMessage: "{companyName} đã mời bạn phỏng vấn cho vị trí {jobTitle}.",
        requestInterviewDetails: "Chi tiết Yêu cầu Phỏng vấn",
        interviewTime: "Thời gian phỏng vấn",
        interviewLocation: "Địa điểm",
        locationPlaceholder: "VD: Trụ sở công ty, Online qua Meet",
        confirmRequest: "Xác nhận Yêu cầu",
        interviewDetails: "Chi tiết Phỏng vấn",
        youAreInvited: "Bạn được mời tham gia một cuộc phỏng vấn!",
        accept: "Chấp nhận",
        decline: "Từ chối",
        interviewAccepted: "Đã chấp nhận phỏng vấn",
        interviewDeclined: "Đã từ chối phỏng vấn",
        pendingResponse: "Chờ bạn phản hồi",
        interviewResponseSuccess: "Phản hồi của bạn đã được ghi nhận.",
        interviewResponseError: "Không thể ghi nhận phản hồi của bạn.",
        unassigned: 'Chưa giao',
        interviewAcceptedTitle: 'Phỏng vấn được chấp nhận',
        interviewDeclinedTitle: 'Phỏng vấn bị từ chối',
        interviewAcceptedMessage: '{studentName} đã chấp nhận lời mời phỏng vấn cho vị trí {jobTitle}.',
        interviewDeclinedMessage: '{studentName} đã từ chối lời mời phỏng vấn cho vị trí {jobTitle}.',
        address: 'Địa chỉ',
        phone: 'Số điện thoại',
        nationalId: 'Số CCCD/CMND',
        companies: 'Công ty',
        agents: 'Tư vấn viên',
        manageCompanies: 'Quản lý tất cả các công ty đối tác.',
        addCompany: 'Thêm công ty',
        editCompany: 'Sửa thông tin công ty',
        deleteCompanyWarning: 'Hành động này sẽ xóa vĩnh viễn công ty {companyName}.',
        industry: 'Ngành nghề',
        contactEmail: 'Email liên hệ',
        manageAgents: 'Quản lý tất cả tài khoản tư vấn viên.',
        addAgent: 'Thêm tư vấn viên',
        editAgent: 'Sửa thông tin tư vấn viên',
        studentDirectory: 'Danh sách Học viên',
        studentDirectoryDesc: 'Duyệt hồ sơ học viên để tìm ứng viên tiềm năng.',
    },
};

export const I18nContext = createContext<I18nContextType | undefined>(undefined);

export function I18nProvider({ children }: { children: React.ReactNode }) {
    const [language, setLanguage] = useState<Language>('en');

    const t = useCallback((key: string, params?: Record<string, string | number>): string => {
        const langDict = translations[language];
        // @ts-ignore
        let translation = langDict[key] || key;
        
        if (params) {
            Object.keys(params).forEach(paramKey => {
                translation = translation.replace(`{${paramKey}}`, String(params[paramKey]));
            });
        }

        return translation;
    }, [language]);

    const value = { language, setLanguage, t };

    return (
        <I18nContext.Provider value={value}>
            {children}
        </I18nContext.Provider>
    );
}