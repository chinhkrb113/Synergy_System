
import React from 'react';
import { createContext, useState, useCallback } from 'react';

type Language = 'en' | 'vi';

interface I18nContextType {
    language: Language;
    setLanguage: (lang: Language) => void;
    t: (key: string, params?: Record<string, string | number>) => string;
}

const translations = {
    en: {
        dashboard: 'Dashboard',
        leads: 'Leads',
        students: 'Students',
        profile: 'Profile',
        jdParser: 'JD Parser',
        settings: 'Settings',
        teams: 'Teams',
        jobs: 'Job Postings',
        opsDashboard: 'Ops Dashboard',
        totalRevenue: 'Total Revenue',
        newLeads: 'New Leads',
        conversionRate: 'Conversion Rate',
        activeLearners: 'Active Learners',
        salesOverview: 'Sales Overview',
        leadsBySource: 'Leads by Source',
        anomalyAlerts: 'Anomaly Alerts',
        viewAll: 'View All',
        ack: 'ACK',
        allLeads: 'All Leads',
        allStudents: 'All Students',
        exportCsv: 'Export CSV',
        name: 'Name',
        status: 'Status',
        score: 'Score',
        tier: 'Tier',
        source: 'Source',
        assignee: 'Assignee',
        created: 'Created',
        actions: 'Actions',
        welcome: 'Welcome to Synergy CRM',
        jdParserTitle: 'Job Description Parser',
        jdParserDesc: 'Paste a job description below to parse skills and requirements.',
        studentProfileTitle: 'Student Skill Profile',
        studentProfileDesc: 'Dynamic skill map for student evaluation and matching.',
        search: 'Search...',
        theme: 'Theme',
        light: 'Light',
        dark: 'Dark',
        system: 'System',
        language: 'Language',
        course: 'Course',
        progress: 'Progress',
        joinDate: 'Join Date',
        addStudent: 'Add Student',
        editStudent: 'Edit Student',
        viewProfile: 'View Profile',
        edit: 'Edit',
        delete: 'Delete',
        taskProgress: 'Task Progress',
        dueDate: 'Due',
        areYouSure: 'Are you sure?',
        deleteStudentWarning: 'This action cannot be undone. This will permanently delete the student and their associated data.',
        cancel: 'Cancel',
        save: 'Save',
        parseAndMatch: 'Parse & Match Candidates',
        parsing: 'Parsing...',
        jdParsingResults: 'JD Parsing Results',
        requiredSkills: 'Required Skills',
        softSkills: 'Soft Skills',
        experience: 'Experience',
        years: 'years',
        hiddenRequirements: 'Hidden Requirements',
        pasteJDPlaceholder: 'Paste your job description here...',
        jdParseError: 'An error occurred while parsing. Please try again.',
        matchingCandidates: "Matching Candidates",
        findingMatches: "Finding matches...",
        matchScore: "Match Score",
        matchingSkills: "Matching Skills",
        noCandidatesFound: "No suitable candidates found for this job description.",
        requestInterview: "Request Interview",
        skills: 'Skills',
        skillsPlaceholder: 'e.g. React, Node.js, SQL',
        skillsHelperText: 'Comma-separated values',
        login: 'Login',
        logout: 'Logout',
        email: 'Email',
        password: 'Password',
        loginToYourAccount: 'Login to your account',
        allTeams: 'All Teams',
        manageTeams: 'Manage student teams and projects.',
        allJobs: 'All Job Postings',
        manageJobs: 'Manage company job postings and candidates.',
        opsDashboardTitle: 'Operations Dashboard',
        opsDashboardDesc: 'System-wide analytics and management.',
        createTeam: 'Create Team',
        addNewTeam: 'Add a new team',
        teamName: 'Team Name',
        projectDescription: 'Project Description',
        projectDescriptionPlaceholder: 'Describe the project goals and tech stack...',
        suggestMembers: 'Suggest Members',
        suggesting: 'Suggesting...',
        suggestedMembers: 'Suggested Members',
        postNewJob: 'Post New Job',
        addNewJob: 'Add a new job posting',
        jobTitle: 'Job Title',
        jobDescription: 'Job Description',
        viewMatches: 'View Matches',
        enrollmentTrends: 'Enrollment Trends',
        teamProjectStatus: 'Team Project Status',
        newStudents: 'New Students',
        skillMap: 'Skill Map',
        dynamicSkillMapDesc: 'Student\'s skills, updated in real-time based on performance.',
        interviewScheduledSuccess: 'Interview successfully scheduled with {candidateName}!',
        requestingInterview: 'Requesting...',
        editTeam: 'Edit Team',
        deleteTeam: 'Delete Team',
        deleteTeamWarning: 'This action cannot be undone. This will permanently delete the team and unassign its members.',
        myTeam: 'My Team',
        myProject: 'My Project',
        mentor: 'Mentor',
        teammates: 'Teammates',
        noTeamAssigned: 'You are not currently assigned to a team.',
        matchedJobs: 'Matched Jobs',
        matchedJobsDesc: 'Job opportunities that match your skill profile.',
        noMatchedJobs: 'No matched jobs found at the moment. Keep improving your skills!',
        viewJob: 'View',
        studentSettings: 'My Settings',
        personalInformation: 'Personal Information',
        fullName: 'Full Name',
        age: 'Age',
        changePassword: 'Change Password',
        currentPassword: 'Current Password',
        newPassword: 'New Password',
        confirmNewPassword: 'Confirm New Password',
        updatePassword: 'Update Password',
        myTeams: 'My Teams',
        teamDetails: 'Team Details',
        projectDetails: 'Project Details',
        members: 'Members',
        manageMembers: 'Manage Members',
        assignTask: 'Assign Task',
        teamTasks: 'Team Tasks',
        assignTo: 'Assign To',
        allMembers: 'All Members',
        taskTitle: 'Task Title',
        editTask: 'Edit Task',
        taskDetails: 'Task Details',
        assignedTo: 'Assigned To',
        updateTask: 'Update Task',
    },
    vi: {
        dashboard: 'Bảng điều khiển',
        leads: 'Khách hàng tiềm năng',
        students: 'Học viên',
        profile: 'Hồ sơ',
        jdParser: 'Phân tích JD',
        settings: 'Cài đặt',
        teams: 'Đội nhóm',
        jobs: 'Tin tuyển dụng',
        opsDashboard: 'Bảng điều khiển Vận hành',
        totalRevenue: 'Tổng doanh thu',
        newLeads: 'Lead mới',
        conversionRate: 'Tỷ lệ chuyển đổi',
        activeLearners: 'Học viên tích cực',
        salesOverview: 'Tổng quan bán hàng',
        leadsBySource: 'Lead theo nguồn',
        anomalyAlerts: 'Cảnh báo bất thường',
        viewAll: 'Xem tất cả',
        ack: 'Xác nhận',
        allLeads: 'Tất cả Lead',
        allStudents: 'Tất cả học viên',
        exportCsv: 'Xuất CSV',
        name: 'Tên',
        status: 'Trạng thái',
        score: 'Điểm',
        tier: 'Mức độ',
        source: 'Nguồn',
        assignee: 'Người phụ trách',
        created: 'Ngày tạo',
        actions: 'Hành động',
        welcome: 'Chào mừng đến với Synergy CRM',
        jdParserTitle: 'Trình phân tích Mô tả Công việc',
        jdParserDesc: 'Dán mô tả công việc vào bên dưới để phân tích kỹ năng và yêu cầu.',
        studentProfileTitle: 'Hồ sơ Năng lực Học viên',
        studentProfileDesc: 'Sơ đồ kỹ năng động để đánh giá và ghép cặp học viên.',
        search: 'Tìm kiếm...',
        theme: 'Giao diện',
        light: 'Sáng',
        dark: 'Tối',
        system: 'Hệ thống',
        language: 'Ngôn ngữ',
        course: 'Khóa học',
        progress: 'Tiến độ',
        joinDate: 'Ngày tham gia',
        addStudent: 'Thêm học viên',
        editStudent: 'Chỉnh sửa học viên',
        viewProfile: 'Xem hồ sơ',
        edit: 'Chỉnh sửa',
        delete: 'Xóa',
        taskProgress: 'Tiến độ nhiệm vụ',
        dueDate: 'Hạn chót',
        areYouSure: 'Bạn có chắc không?',
        deleteStudentWarning: 'Hành động này không thể hoàn tác. Thao tác này sẽ xóa vĩnh viễn học viên và dữ liệu liên quan của họ.',
        cancel: 'Hủy',
        save: 'Lưu',
        parseAndMatch: 'Phân tích & Ghép cặp',
        parsing: 'Đang phân tích...',
        jdParsingResults: 'Kết quả phân tích JD',
        requiredSkills: 'Kỹ năng yêu cầu',
        softSkills: 'Kỹ năng mềm',
        experience: 'Kinh nghiệm',
        years: 'năm',
        hiddenRequirements: 'Yêu cầu ẩn',
        pasteJDPlaceholder: 'Dán mô tả công việc của bạn vào đây...',
        jdParseError: 'Đã xảy ra lỗi khi phân tích. Vui lòng thử lại.',
        matchingCandidates: "Ứng viên phù hợp",
        findingMatches: "Đang tìm ứng viên...",
        matchScore: "Điểm phù hợp",
        matchingSkills: "Kỹ năng trùng khớp",
        noCandidatesFound: "Không tìm thấy ứng viên phù hợp cho mô tả công việc này.",
        requestInterview: "Yêu cầu phỏng vấn",
        skills: 'Kỹ năng',
        skillsPlaceholder: 'VD: React, Node.js, SQL',
        skillsHelperText: 'Các giá trị cách nhau bằng dấu phẩy',
        login: 'Đăng nhập',
        logout: 'Đăng xuất',
        email: 'Email',
        password: 'Mật khẩu',
        loginToYourAccount: 'Đăng nhập vào tài khoản của bạn',
        allTeams: 'Tất cả Đội nhóm',
        manageTeams: 'Quản lý các đội nhóm và dự án của học viên.',
        allJobs: 'Tất cả Tin tuyển dụng',
        manageJobs: 'Quản lý tin tuyển dụng và ứng viên.',
        opsDashboardTitle: 'Bảng điều khiển Vận hành',
        opsDashboardDesc: 'Phân tích và quản lý toàn hệ thống.',
        createTeam: 'Tạo Đội',
        addNewTeam: 'Thêm một đội mới',
        teamName: 'Tên Đội',
        projectDescription: 'Mô tả dự án',
        projectDescriptionPlaceholder: 'Mô tả mục tiêu và công nghệ của dự án...',
        suggestMembers: 'Gợi ý thành viên',
        suggesting: 'Đang gợi ý...',
        suggestedMembers: 'Thành viên được gợi ý',
        postNewJob: 'Đăng tin mới',
        addNewJob: 'Thêm một tin tuyển dụng mới',
        jobTitle: 'Chức danh',
        jobDescription: 'Mô tả công việc',
        viewMatches: 'Xem ứng viên',
        enrollmentTrends: 'Xu hướng Tuyển sinh',
        teamProjectStatus: 'Trạng thái Dự án các Đội',
        newStudents: 'Học viên mới',
        skillMap: 'Bản đồ Kỹ năng',
        dynamicSkillMapDesc: 'Kỹ năng của học viên, được cập nhật thời gian thực dựa trên hiệu suất.',
        interviewScheduledSuccess: 'Đã lên lịch phỏng vấn thành công với {candidateName}!',
        requestingInterview: 'Đang yêu cầu...',
        editTeam: 'Chỉnh sửa Đội',
        deleteTeam: 'Xóa Đội',
        deleteTeamWarning: 'Hành động này không thể hoàn tác. Thao tác này sẽ xóa vĩnh viễn đội và hủy phân công các thành viên.',
        myTeam: 'Đội của tôi',
        myProject: 'Dự án của tôi',
        mentor: 'Người hướng dẫn',
        teammates: 'Đồng đội',
        noTeamAssigned: 'Bạn hiện chưa được phân vào đội nào.',
        matchedJobs: 'Việc làm phù hợp',
        matchedJobsDesc: 'Các cơ hội việc làm phù hợp với hồ sơ kỹ năng của bạn.',
        noMatchedJobs: 'Hiện không có việc làm phù hợp. Hãy tiếp tục trau dồi kỹ năng!',
        viewJob: 'Xem',
        studentSettings: 'Cài đặt của tôi',
        personalInformation: 'Thông tin cá nhân',
        fullName: 'Họ và tên',
        age: 'Tuổi',
        changePassword: 'Đổi mật khẩu',
        currentPassword: 'Mật khẩu hiện tại',
        newPassword: 'Mật khẩu mới',
        confirmNewPassword: 'Xác nhận mật khẩu mới',
        updatePassword: 'Cập nhật mật khẩu',
        myTeams: 'Đội của tôi',
        teamDetails: 'Chi tiết đội',
        projectDetails: 'Chi tiết dự án',
        members: 'Thành viên',
        manageMembers: 'Quản lý thành viên',
        assignTask: 'Giao nhiệm vụ',
        teamTasks: 'Nhiệm vụ của đội',
        assignTo: 'Giao cho',
        allMembers: 'Tất cả thành viên',
        taskTitle: 'Tiêu đề nhiệm vụ',
        editTask: 'Chỉnh sửa Nhiệm vụ',
        taskDetails: 'Chi tiết Nhiệm vụ',
        assignedTo: 'Giao cho',
        updateTask: 'Cập nhật Nhiệm vụ',
    },
};

export const I18nContext = createContext<I18nContextType | undefined>(undefined);

export function I18nProvider({ children }: { children: React.ReactNode }) {
    const [language, setLanguage] = useState<Language>('en');

    const t = useCallback((key: string, params?: Record<string, string | number>): string => {
        const langDict = translations[language];
        // @ts-ignore
        let translation = langDict[key] || key;
        
        if (params) {
            Object.keys(params).forEach(paramKey => {
                translation = translation.replace(`{${paramKey}}`, String(params[paramKey]));
            });
        }

        return translation;
    }, [language]);

    const value = { language, setLanguage, t };

    return (
        <I18nContext.Provider value={value}>
            {children}
        </I18nContext.Provider>
    );
}